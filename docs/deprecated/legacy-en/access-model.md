# Access Model

## ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿

**Secure by Default** - ÑĞ°Ğ¹Ñ‚ Ğ·Ğ°ĞºÑ€Ğ¸Ñ‚Ğ¸Ğ¹ Ğ±ĞµĞ· ÑĞ²Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ.

## Ğ Ñ–Ğ²Ğ½Ñ– Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ

### 1. Public (Ğ±ĞµĞ· ĞºĞ¾Ğ´Ñƒ)

```
Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾:
- Ğ¡Ñ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ° "Access Required"
- Health check endpoint

ĞĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾:
- ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ ÑĞ°Ğ¹Ñ‚Ñƒ
- Notes
- Search
- Tags
```

### 2. Zone Access (ĞºĞ¾Ğ´ Ğ·Ğ¾Ğ½Ğ¸)

```
Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾:
- Notes Ğ² Ğ·Ğ¾Ğ½Ñ–
- ĞŸĞ¾ÑˆÑƒĞº Ğ¿Ğ¾ Ğ·Ğ¾Ğ½Ñ–
- Tags Ğ² Ğ·Ğ¾Ğ½Ñ–

ĞĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾:
- Ğ†Ğ½ÑˆÑ– notes
- Owner Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
- Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ğ·Ğ¾Ğ½
```

### 3. Owner Access (master-ĞºĞ¾Ğ´)

```
Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾:
- Ğ’ĞµÑÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ·Ğ¾Ğ½Ğ°Ğ¼Ğ¸
- MCP ÑĞµÑÑ–Ñ—
- ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ
```

## Access Gate Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  User Request                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Check Session Cookie                â”‚
â”‚                                                  â”‚
â”‚   garden_session = valid?                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                         â”‚
        Valid                    No Cookie
           â”‚                         â”‚
           â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Allow Access  â”‚     â”‚   Show Access Required  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   User Enters Code      â”‚
                        â”‚                         â”‚
                        â”‚   - Master code         â”‚
                        â”‚   - Zone code           â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   Validate Code         â”‚
                        â”‚                         â”‚
                        â”‚   POST /auth/login      â”‚
                        â”‚   or                    â”‚
                        â”‚   GET /zones/validate   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                         â”‚
                     Valid                    Invalid
                        â”‚                         â”‚
                        â–¼                         â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   Set Cookie        â”‚   â”‚   Show Error    â”‚
           â”‚   Redirect to App   â”‚   â”‚                 â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Code Formats

### Master Code

```
Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°
Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ğ½Ğ½Ñ: Hash Ğ² KV (owner:password_hash)
Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Full access JWT
```

### Zone Code

```
Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: ZONE-XXXX-YYYY
Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ğ½Ğ½Ñ: Ğ’ zone object Ğ² KV
Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Limited access token
Ğ•ĞºÑĞ¿Ñ–Ñ€Ğ°Ñ†Ñ–Ñ: Ğ—Ğ° Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½ÑĞ¼ Ğ·Ğ¾Ğ½Ğ¸
```

## Session Storage

### Cookie (Primary)

```
Name: garden_session
Value: encrypted_session_id
Flags: HttpOnly, Secure, SameSite=Strict
TTL: 24h (owner), zone expiry (guest)
```

### LocalStorage (Fallback)

```javascript
// Ğ”Ğ»Ñ zone access
localStorage.setItem('garden_zone_access', JSON.stringify({
  zoneId: 'zone_abc',
  code: 'ZONE-XXXX-YYYY',
  expiresAt: '2024-01-15T12:00:00Z'
}));
```

## Implementation Status

| Feature | Status | Location |
|---------|--------|----------|
| Owner login | âœ… Done | `OwnerLoginDialog.tsx` |
| JWT validation | âœ… Done | Worker `/auth/validate` |
| Zone creation | ğŸ”´ Broken | Worker `/zones/create` |
| Zone validation | âš ï¸ Partial | Worker `/zones/validate` |
| Access Gate UI | âŒ TODO | `AccessGate.tsx` |
| Cookie session | âŒ TODO | Worker + Frontend |
